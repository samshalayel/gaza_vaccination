<!doctype html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>Gaza Vaccination Map</title>
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-search.css">
        <link rel="stylesheet" href="css/nouislider.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #10b981;
            --background-light: #f8fafc;
            --background-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            font-family: 'Inter', 'Segoe UI', Tahoma, sans-serif;
        }

        #all {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
        }

        #menu {
            width: 340px;
            min-width: 340px;
            height: 100%;
            overflow-y: auto;
            background: linear-gradient(180deg, var(--background-light) 0%, #fff 100%);
            padding: 0;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }

        .menu-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .menu-header h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .menu-header p {
            margin: 5px 0 0 0;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .filters-container {
            padding: 15px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 15px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--border-color);
        }

        .filter-section {
            background: var(--background-card);
            border-radius: var(--radius-md);
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .filter-section:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .filter-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .filter-label i {
            color: var(--primary-color);
            font-size: 0.85rem;
        }

        .filter-value {
            font-size: 0.7rem;
            color: var(--primary-color);
            font-weight: 600;
            background: rgba(37, 99, 235, 0.1);
            padding: 3px 8px;
            border-radius: 20px;
            margin-left: auto;
        }

        .clear-filter {
            font-size: 0.65rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 3px 8px;
            border-radius: 4px;
            transition: all 0.2s;
            background: transparent;
            border: none;
        }

        .clear-filter:hover {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .slider {
            margin: 8px 5px 5px 5px;
        }

        .noUi-target {
            background: var(--border-color);
            border: none;
            box-shadow: none;
            height: 5px;
            border-radius: 3px;
        }

        .noUi-connect {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 3px;
        }

        .noUi-handle {
            width: 16px !important;
            height: 16px !important;
            border-radius: 50% !important;
            background: white !important;
            border: 3px solid var(--primary-color) !important;
            box-shadow: var(--shadow-md) !important;
            top: -6px !important;
            cursor: pointer;
        }

        .noUi-handle:before, .noUi-handle:after {
            display: none !important;
        }

        .filter-select {
            width: 100%;
            min-height: 80px;
            max-height: 120px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            padding: 4px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .filter-select option {
            padding: 6px;
            border-radius: 4px;
        }

        .filter-select option:checked {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        #map {
            flex: 1;
            height: 100%;
        }

        /* Scrollbar styling */
        #menu::-webkit-scrollbar {
            width: 5px;
        }

        #menu::-webkit-scrollbar-track {
            background: var(--background-light);
        }

        #menu::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        #menu::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Leaflet customizations */
        .leaflet-control-search {
            box-shadow: var(--shadow-lg) !important;
            border-radius: var(--radius-lg) !important;
            border: none !important;
            overflow: hidden;
        }

        .leaflet-control-search .search-input {
            font-family: 'Inter', sans-serif !important;
            font-size: 0.85rem !important;
            padding: 10px 15px !important;
            border: none !important;
            background: white !important;
            min-width: 280px !important;
        }

        .leaflet-control-search .search-input:focus {
            outline: none !important;
            box-shadow: inset 0 0 0 2px var(--primary-color) !important;
        }

        .leaflet-control-search .search-button {
            background: var(--primary-color) !important;
            border: none !important;
            padding: 10px 14px !important;
            cursor: pointer !important;
        }

        .leaflet-control-search .search-button:hover {
            background: var(--primary-dark) !important;
        }

        .leaflet-control-search .search-button:after {
            content: '\f002' !important;
            font-family: 'Font Awesome 5 Free' !important;
            font-weight: 900 !important;
            font-size: 14px !important;
            color: white !important;
        }

        .leaflet-control-search .search-cancel {
            background: #ef4444 !important;
            border: none !important;
        }

        .leaflet-control-search .search-tooltip {
            font-family: 'Inter', sans-serif !important;
            border-radius: var(--radius-sm) !important;
            box-shadow: var(--shadow-md) !important;
            border: 1px solid var(--border-color) !important;
            max-height: 300px !important;
            overflow-y: auto !important;
        }

        .leaflet-control-search .search-tip {
            padding: 10px 15px !important;
            font-size: 0.8rem !important;
            border-bottom: 1px solid var(--border-color) !important;
            cursor: pointer !important;
            transition: all 0.2s !important;
        }

        .leaflet-control-search .search-tip:hover {
            background: var(--background-light) !important;
            color: var(--primary-color) !important;
        }

        .leaflet-control-search .search-tip-select {
            background: var(--primary-color) !important;
            color: white !important;
        }

        .leaflet-popup-content-wrapper {
            border-radius: var(--radius-md) !important;
            box-shadow: var(--shadow-lg) !important;
        }

        .leaflet-popup-content {
            margin: 0 !important;
            min-width: 280px;
        }

        .popup-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 12px 15px;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            margin: -1px -1px 0 -1px;
        }

        .popup-header h3 {
            margin: 0;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .popup-header .governorate {
            font-size: 0.75rem;
            opacity: 0.9;
            margin-top: 3px;
        }

        .popup-body {
            padding: 12px 15px;
        }

        .popup-section {
            margin-bottom: 12px;
        }

        .popup-section:last-child {
            margin-bottom: 0;
        }

        .popup-section-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 6px;
            letter-spacing: 0.3px;
        }

        .popup-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }

        .popup-stat {
            background: var(--background-light);
            padding: 8px;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .popup-stat .value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .popup-stat .label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .popup-stat.success .value { color: #10b981; }
        .popup-stat.warning .value { color: #f59e0b; }
        .popup-stat.danger .value { color: #ef4444; }

        .vaccine-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
        }

        .popup-grid.three-cols {
            grid-template-columns: repeat(3, 1fr);
        }

        .vaccine-item {
            background: var(--background-light);
            padding: 4px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.65rem;
        }

        .vaccine-item .count {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            #menu {
                width: 300px;
                min-width: 300px;
            }

            .menu-header h1 {
                font-size: 1rem;
            }
        }
        </style>
    </head>
    <body>
        <div id="all">
            <div id="menu">
                <div class="menu-header">
                    <h1><i class="fas fa-syringe"></i> Gaza Vaccination Map</h1>
                    <p>Palestinian Immunization Schedule Tracking</p>
                </div>
                <div class="filters-container" id="filters-container">
                    <!-- Filters will be added here dynamically -->
                </div>
            </div>
            <div id="map"></div>
        </div>

        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="js/leaflet-search.js"></script>
        <script src="js/nouislider.min.js"></script>
        <script src="js/wNumb.js"></script>
        <script src="data/vaccination_data.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;
            highlightLayer.setStyle({
                fillColor: 'rgba(255, 255, 0, 1.00)',
                fillOpacity: 1
            });
            highlightLayer.openPopup();
        }

        var map = L.map('map', {
            zoomControl: false,
            maxZoom: 28,
            minZoom: 1
        }).fitBounds([[31.20507802512429,34.119629865067616],[31.541582704655145,34.51231792690869]]);

        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');

        var zoomControl = L.control.zoom({ position: 'topleft' }).addTo(map);
        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);

        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';

        var bounds_group = new L.featureGroup([]);

        map.createPane('pane_OpenStreetMap_0');
        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
        var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        map.addLayer(layer_OpenStreetMap_0);

        function pop_vaccination_data(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    }
                },
                mouseover: highlightFeature,
            });
            var p = feature.properties;

            var popupContent = '<div class="popup-header">' +
                '<h3>' + (p['Health Facility'] || '') + '</h3>' +
                '<div class="governorate"><i class="fas fa-map-marker-alt"></i> ' + (p['Governorate'] || '') + '</div>' +
                '</div>' +
                '<div class="popup-body">' +

                '<div class="popup-section">' +
                '<div class="popup-section-title">Children Summary</div>' +
                '<div class="popup-grid">' +
                '<div class="popup-stat"><div class="value">' + (p['Total Children'] || 0) + '</div><div class="label">Total</div></div>' +
                '<div class="popup-stat success"><div class="value">' + (p['On Schedule'] || 0) + '</div><div class="label">On Schedule</div></div>' +
                '<div class="popup-stat warning"><div class="value">' + (p['Defaulter'] || 0) + '</div><div class="label">Defaulter</div></div>' +
                '<div class="popup-stat danger"><div class="value">' + (p['Zero Dose'] || 0) + '</div><div class="label">Zero Dose</div></div>' +
                '</div></div>' +

                '<div class="popup-section">' +
                '<div class="popup-section-title">Age Groups (Target: 0-36 Months)</div>' +
                '<div class="popup-grid three-cols">' +
                '<div class="popup-stat"><div class="value">' + (p['Age 0-12 Months'] || 0) + '</div><div class="label">0-12 M</div></div>' +
                '<div class="popup-stat"><div class="value">' + (p['Age 12-24 Months'] || 0) + '</div><div class="label">12-24 M</div></div>' +
                '<div class="popup-stat"><div class="value">' + (p['Age 24-36 Months'] || 0) + '</div><div class="label">24-36 M</div></div>' +
                '</div></div>' +

                '<div class="popup-section">' +
                '<div class="popup-section-title">Vaccination Visits (Palestinian Schedule)</div>' +
                '<div class="vaccine-grid">' +
                '<div class="vaccine-item"><div class="count">' + (p['Visit1_Birth'] || 0) + '</div>Birth</div>' +
                '<div class="vaccine-item"><div class="count">' + (p['Visit2_1Month'] || 0) + '</div>1 Month</div>' +
                '<div class="vaccine-item"><div class="count">' + (p['Visit3_2Months'] || 0) + '</div>2 Months</div>' +
                '<div class="vaccine-item"><div class="count">' + (p['Visit4_4Months'] || 0) + '</div>4 Months</div>' +
                '<div class="vaccine-item"><div class="count">' + (p['Visit5_6Months'] || 0) + '</div>6 Months</div>' +
                '<div class="vaccine-item"><div class="count">' + (p['Visit6_12Months'] || 0) + '</div>12 Months</div>' +
                '<div class="vaccine-item"><div class="count">' + (p['Visit7_18Months'] || 0) + '</div>18 Months</div>' +
                '</div></div>' +

                '</div>';

            layer.bindPopup(popupContent, { maxHeight: 450, maxWidth: 320 });
        }

        function style_vaccination_data_0(feature) {
            var totalChildren = feature.properties['Total Children'] || 0;

            // Circle size based on total children: 0-200, 200-400, 400-600, 600-800, 800-1000
            var radius;
            if (totalChildren <= 200) {
                radius = 6;
            } else if (totalChildren <= 400) {
                radius = 9;
            } else if (totalChildren <= 600) {
                radius = 12;
            } else if (totalChildren <= 800) {
                radius = 15;
            } else {
                radius = 18;
            }

            // Color based on governorate
            var colors = {
                'Gaza': '#e74c3c',
                'North Gaza': '#9b59b6',
                'Middle zone': '#3498db',
                'Khan Younis': '#2ecc71',
                'Rafah': '#f39c12'
            };
            var fillColor = colors[feature.properties['Governorate']] || '#95a5a6';

            return {
                pane: 'pane_vaccination_data',
                radius: radius,
                opacity: 1,
                color: '#2c3e50',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2,
                fill: true,
                fillOpacity: 0.8,
                fillColor: fillColor,
                interactive: true,
            };
        }

        map.createPane('pane_vaccination_data');
        map.getPane('pane_vaccination_data').style.zIndex = 401;
        map.getPane('pane_vaccination_data').style['mix-blend-mode'] = 'normal';

        var layer_vaccination_data = new L.geoJson(json_vaccination_data, {
            attribution: '',
            interactive: true,
            dataVar: 'json_vaccination_data',
            layerName: 'layer_vaccination_data',
            pane: 'pane_vaccination_data',
            onEachFeature: pop_vaccination_data,
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, style_vaccination_data_0(feature));
            },
        });
        bounds_group.addLayer(layer_vaccination_data);
        map.addLayer(layer_vaccination_data);

        // Search control
        var searchControl = new L.Control.Search({
            layer: layer_vaccination_data,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'Health Facility',
            textPlaceholder: 'Search health facility...',
            position: 'topleft',
            zoom: 16,
            marker: false,
            minLength: 1,
            autoType: false,
            tipAutoSubmit: true,
            moveToLocation: function(latlng, title, map) {
                map.setView(latlng, 16);
            }
        });
        map.addControl(searchControl);

        searchControl.on('search:locationfound', function(e) {
            if (e.layer) {
                map.setView(e.latlng, 16);
                setTimeout(function() {
                    e.layer.openPopup();
                    var originalStyle = style_vaccination_data_0(e.layer.feature);
                    e.layer.setStyle({ fillColor: '#ffeb3b', fillOpacity: 1 });
                    setTimeout(function() {
                        e.layer.setStyle(originalStyle);
                    }, 1000);
                }, 300);
            }
        });

        // Filter functionality
        var Filters = {
            "Governorate": "str",
            "Health Facility": "str",
            "Total Children": "int",
            "On Schedule": "int",
            "Defaulter": "int",
            "Zero Dose": "int",
            "Visit1_Birth": "int",
            "Visit2_1Month": "int",
            "Visit3_2Months": "int",
            "Visit4_4Months": "int",
            "Visit5_6Months": "int",
            "Visit6_12Months": "int",
            "Visit7_18Months": "int"
        };

        function filterFunc() {
            map.eachLayer(function(lyr) {
                if ("options" in lyr && "dataVar" in lyr["options"]) {
                    var features = window[lyr["options"]["dataVar"]].features.slice(0);
                    try {
                        for (var key in Filters) {
                            var keyS = key.replace(/[^a-zA-Z0-9_]/g, "");
                            if (Filters[key] == "str") {
                                var selection = [];
                                var el = document.getElementById("sel_" + keyS);
                                if (!el) continue;
                                var options = el.options;
                                for (var i = 0; i < options.length; i++) {
                                    if (options[i].selected) selection.push(options[i].value);
                                }
                                try {
                                    if (key in features[0].properties) {
                                        for (var i = features.length - 1; i >= 0; --i) {
                                            if (selection.indexOf(features[i].properties[key]) < 0 && selection.length > 0) {
                                                features.splice(i, 1);
                                            }
                                        }
                                    }
                                } catch(err) {}
                            }
                            if (Filters[key] == "int") {
                                var sliderEl = document.getElementById("div_" + keyS);
                                if (!sliderEl || !sliderEl.noUiSlider) continue;
                                var sliderVals = sliderEl.noUiSlider.get();
                                try {
                                    if (key in features[0].properties) {
                                        for (var i = features.length - 1; i >= 0; --i) {
                                            var val = parseInt(features[i].properties[key]) || 0;
                                            if (val < parseInt(sliderVals[0]) || val > parseInt(sliderVals[1])) {
                                                features.splice(i, 1);
                                            }
                                        }
                                    }
                                } catch(err) {}
                            }
                        }
                    } catch(err) {}
                    window[lyr["options"]["layerName"]].clearLayers();
                    window[lyr["options"]["layerName"]].addData(features);
                }
            });
        }

        // Create filter UI
        var filtersContainer = document.getElementById("filters-container");

        // === GENERAL FILTERS ===
        var generalTitle = document.createElement('div');
        generalTitle.className = 'section-title';
        generalTitle.innerHTML = '<i class="fas fa-filter"></i> General Filters';
        filtersContainer.appendChild(generalTitle);

        // Governorate filter
        var govSection = document.createElement('div');
        govSection.className = 'filter-section';
        govSection.innerHTML = '<div class="filter-label"><i class="fas fa-map-marker-alt"></i> Governorate <button class="clear-filter" onclick="clearSelect(\'sel_Governorate\')">Clear</button></div>';
        var govSelect = document.createElement('select');
        govSelect.multiple = true;
        govSelect.size = 5;
        govSelect.id = "sel_Governorate";
        govSelect.className = "filter-select";
        govSelect.onchange = filterFunc;
        govSelect.innerHTML = '<option value="Gaza">Gaza</option><option value="Khan Younis">Khan Younis</option><option value="Middle zone">Middle Zone</option><option value="North Gaza">North Gaza</option><option value="Rafah">Rafah</option>';
        govSection.appendChild(govSelect);
        filtersContainer.appendChild(govSection);

        // Health Facility filter
        var facilitySection = document.createElement('div');
        facilitySection.className = 'filter-section';
        facilitySection.innerHTML = '<div class="filter-label"><i class="fas fa-hospital"></i> Health Facility <button class="clear-filter" onclick="clearSelect(\'sel_HealthFacility\')">Clear</button></div>';
        var facilitySelect = document.createElement('select');
        facilitySelect.multiple = true;
        facilitySelect.size = 6;
        facilitySelect.id = "sel_HealthFacility";
        facilitySelect.className = "filter-select";
        facilitySelect.onchange = filterFunc;

        var facilities = [];
        json_vaccination_data.features.forEach(function(f) {
            var name = f.properties['Health Facility'];
            if (name && facilities.indexOf(name) === -1) {
                facilities.push(name);
            }
        });
        facilities.sort();

        var facilityOptions = '';
        facilities.forEach(function(f) {
            facilityOptions += '<option value="' + f.replace(/"/g, '&quot;') + '">' + f + '</option>';
        });
        facilitySelect.innerHTML = facilityOptions;
        facilitySection.appendChild(facilitySelect);
        filtersContainer.appendChild(facilitySection);

        // === CHILDREN STATUS ===
        var statusTitle = document.createElement('div');
        statusTitle.className = 'section-title';
        statusTitle.innerHTML = '<i class="fas fa-child"></i> Children Status';
        filtersContainer.appendChild(statusTitle);

        // Total Children slider
        createSlider('Total Children', 'TotalChildren', 'fa-users', 0, 1000);
        createSlider('On Schedule', 'OnSchedule', 'fa-calendar-check', 0, 600);
        createSlider('Defaulter', 'Defaulter', 'fa-user-clock', 0, 200);
        createSlider('Zero Dose', 'ZeroDose', 'fa-ban', 0, 100);

        // === VACCINATION VISITS ===
        var visitsTitle = document.createElement('div');
        visitsTitle.className = 'section-title';
        visitsTitle.innerHTML = '<i class="fas fa-syringe"></i> Vaccination Visits (Palestinian Schedule)';
        filtersContainer.appendChild(visitsTitle);

        createSlider('Visit 1: Birth (BCG, HepB)', 'Visit1_Birth', 'fa-baby', 0, 400);
        createSlider('Visit 2: 1 Month (IPV1)', 'Visit2_1Month', 'fa-syringe', 0, 100);
        createSlider('Visit 3: 2 Months (5 vaccines)', 'Visit3_2Months', 'fa-syringe', 0, 700);
        createSlider('Visit 4: 4 Months (4 vaccines)', 'Visit4_4Months', 'fa-syringe', 0, 400);
        createSlider('Visit 5: 6 Months (3 vaccines)', 'Visit5_6Months', 'fa-syringe', 0, 300);
        createSlider('Visit 6: 12 Months (PCV3, MMR1)', 'Visit6_12Months', 'fa-syringe', 0, 200);
        createSlider('Visit 7: 18 Months (bOPV4, MMR2, DTP)', 'Visit7_18Months', 'fa-syringe', 0, 300);

        function createSlider(label, id, icon, min, max) {
            var section = document.createElement('div');
            section.className = 'filter-section';
            section.innerHTML = '<div class="filter-label"><i class="fas ' + icon + '"></i> ' + label + ' <span class="filter-value" id="val_' + id + '">' + min + ' - ' + max + '</span> <button class="clear-filter" onclick="resetSlider(\'div_' + id + '\')">Clear</button></div>';
            var slider = document.createElement('div');
            slider.id = 'div_' + id;
            slider.className = 'slider';
            section.appendChild(slider);
            filtersContainer.appendChild(section);

            noUiSlider.create(slider, {
                connect: true,
                start: [min, max],
                step: 1,
                format: wNumb({ decimals: 0 }),
                range: { min: min, max: max }
            });
            slider.noUiSlider.on('update', function(values) {
                document.getElementById('val_' + id).innerHTML = values.join(' - ');
                filterFunc();
            });
        }

        // Helper functions
        function clearSelect(selectId) {
            var el = document.getElementById(selectId);
            if (!el) return;
            var options = el.options;
            for (var i = 0; i < options.length; i++) {
                options[i].selected = false;
            }
            filterFunc();
        }

        function resetSlider(sliderId) {
            var el = document.getElementById(sliderId);
            if (el && el.noUiSlider) {
                el.noUiSlider.reset();
            }
        }
        </script>
    </body>
</html>
